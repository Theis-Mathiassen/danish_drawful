<!DOCTYPE html>
<html>
<head>
    <title>Drawful-Inspired Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Basic styles for the canvas */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            font-family: sans-serif;
            background-color: #f0f0f0; /* Light background for body */
        }
        canvas {
            border: 2px solid #333;
            background-color: #fff; /* White background for canvas */
            margin-bottom: 20px;
            /* Make canvas responsive in width, and limit maximum size */
            width: 95%; /* Take up most of the screen width */
            max-width: 500px; /* But don't get too big */
            height: 66.66vh; /* 2/3 of the viewport height */
            max-height: 66.66vh;
            aspect-ratio: 5 / 3;
        }
    </style>
</head>
<body>
    <h2 id="title"></h2>
    <canvas id="myCanvas"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.js"></script>
    <script>
        const socket = io();
        const canvas = document.getElementById('myCanvas');
        const title = document.getElementById('title');
        const ctx = canvas.getContext('2d');

        // Adjust canvas size on initial load and resize
        function resizeCanvas() {
            const containerWidth = document.body.clientWidth * 0.95; // 95% of body width
            const maxWidth = 500;
            const canvasWidth = Math.min(containerWidth, maxWidth);
            const canvasHeight = window.innerHeight * 0.6666; // 2/3 of window height
            const maxCanvasHeight = window.innerHeight * 0.6666;

            canvas.style.width = `${canvasWidth}px`;
            canvas.style.height = `${canvasHeight}px`;

            // Update the canvas's actual dimensions
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
        }

        resizeCanvas(); // Initial resize
        window.addEventListener('resize', resizeCanvas); // Resize on window resize



        // Drawing setup
        let drawing = false;
        let lastX = 0;
        let lastY = 0;

        function getTouchPos(canvasDom, touchEvent) {
            const rect = canvasDom.getBoundingClientRect();
            return {
                x: touchEvent.touches[0].clientX - rect.left,
                y: touchEvent.touches[0].clientY - rect.top
            };
        }

        function draw(x, y) {
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);  // Start from the previous point
            ctx.lineTo(x, y);        // Draw a line to the current point
            ctx.lineWidth = 5;       // Set line thickness
            ctx.strokeStyle = 'black'; // Set line color
            ctx.lineCap = 'round';  // Rounded line ends
            ctx.stroke();          // Draw the line

            lastX = x;            // Update lastX and lastY
            lastY = y;
            sendCanvasData();
        }

        function sendCanvasData() {
            const dataURL = canvas.toDataURL();
            socket.emit('canvasUpdate', dataURL);
        }

        // Mouse event listeners
        canvas.addEventListener('mousedown', (e) => {
            drawing = true;
            lastX = e.offsetX;  // Store starting point
            lastY = e.offsetY;
            draw(e.offsetX, e.offsetY);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!drawing) return;
            const x = e.offsetX;
            const y = e.offsetY;
            draw(x, y);
        });

        canvas.addEventListener('mouseup', () => {
            drawing = false;
        });

        // Touch event listeners
        canvas.addEventListener('touchstart', (e) => {
            drawing = true;
            e.preventDefault(); // Prevents scrolling
            const touchPos = getTouchPos(canvas, e);
            lastX = touchPos.x;
            lastY = touchPos.y;
            draw(touchPos.x, touchPos.y);
        });

        canvas.addEventListener('touchmove', (e) => {
            if (!drawing) return;
            e.preventDefault(); // Prevent scrolling
            const touchPos = getTouchPos(canvas, e);
            draw(touchPos.x, touchPos.y);
        });

        canvas.addEventListener('touchend', () => {
            drawing = false;
        });

        socket.on('timeUp', () => {
            alert('Time is up!');
        });
        socket.on('reset', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
        socket.on('new_round', (text, time) => {
            title.textContent = 'Du skal tegne: ' + text;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
    </script>
</body>
</html>
